define("futures/scripts/userInfo/updatePassword.js",function(e,r,t){function n(){if(T&&(u=pbE.HQ(),c=pbE.SYS(),v=pbE.ZX(),p=pbE.INFO()),"undefined"!=typeof pbE){var e=pbE.SYS().getDeviceJsonInfo();if(e){var r=JSON.parse(e);if(r[71]&&(E=r[71]),r[255]){var t=r[255];"2"==t?P="iOS":"3"==t&&(P="Android")}r[73]&&(N=r[73]),r.jgid&&(k=r.jgid)}}}function o(){$.bindEvent($(g+" .icon_back"),function(){window.location.href="goBack"}),$.bindEvent($(g+" .code_btn"),function(){var e=pbE.SYS().getAppCertifyInfo("PbKey_H5_Home_Auth_LoginName");$.ajax({type:"POST",url:w+"getOtp",data:{poboNumber:y,loginName:e,loginType:S,deviceId:E,orgNumber:k},dataType:"json",success:function(e){0==e.findByPhone.returnFlag&&(alert("发送成功"),f=e.findByPhone.userId,I=60,a($(g+" .code_btn")))},error:function(){alert("连接超时，请检查网络后重试")}})}),$.bindEvent($(g+" #update_btn"),function(){var e=$.trim($(g+" #old_password").val()),r=$.trim($(g+" #new_password").val()),t=$.trim($(g+" #reset_password").val()),n=$.trim($(g+" #message_code").val());if(n.length<4)return void alert("短信验证码不能为空");if(e.length<7&&e.length>20)return void alert("原登录密码必须是8-20位字母和数字的组合");if(e.length<8||e.length>20)return 0==e.length?void alert("原登录密码不能为空"):void alert("原登录密码必须是8-20位字母和数字的组合");for(var o=0,a=0;a<e.length;a++)if(e[a].match(/^[a-zA-z]+$/)){o+=1;break}for(var a=0;a<e.length;a++)if(e[a].match(/^\d+$/)){o+=1;break}if(2!=o)return void alert("原登录密码只能是数字和字母组合");if(r.length<7&&r.length>20)return void alert("新登录密码必须是8-20位字母和数字的组合");if(r.length<8||r.length>20)return 0==r.length?void alert("新登录密码不能为空"):void alert("新登录密码必须是8-20位字母和数字的组合");for(var o=0,a=0;a<r.length;a++)if(r[a].match(/^[a-zA-z]+$/)){o+=1;break}for(var a=0;a<r.length;a++)if(r[a].match(/^\d+$/)){o+=1;break}if(2!=o)return void alert("新登录密码只能是数字和字母组合");if(t.length<7&&t.length>20)return void alert("确认登录密码必须是8-20位字母和数字的组合");if(t.length<8||t.length>20)return 0==t.length?void alert("确认登录密码不能为空"):void alert("确认登录密码必须是8-20位字母和数字的组合");for(var o=0,a=0;a<t.length;a++)if(t[a].match(/^[a-zA-z]+$/)){o+=1;break}for(var a=0;a<t.length;a++)if(t[a].match(/^\d+$/)){o+=1;break}if(2!=o)return void alert("确认登录密码只能是数字和字母组合");if(e.length<7&&e.length>20)return void alert("登录密码必须是8-20为字母和数字的组合");if(r.length<8||r.length>20)return 0==r.length?void alert("登录密码不能为空"):void alert("登录密码必须是8-20为字母和数字的组合");for(var o=0,a=0;a<r.length;a++)if(r[a].match(/^[a-zA-z]+$/)){o+=1;break}for(var a=0;a<r.length;a++)if(r[a].match(/^\d+$/)){o+=1;break}if(2!=o)return void alert("登录密码只能是数字和字母组合");if(r==t){var l={original_password:e,login_password:r,login_password_twice:t};i(l)}else alert("两次密码不一致")})}function i(e){var r=pbE.SYS().getAppCertifyInfo("PbKey_H5_Home_Auth_LoginName"),t=$.trim($("#message_code").val()),n=e.login_password;e.login_password_twice;$.ajax({type:"POST",url:w+"changePwd",data:{poboNumber:y,loginName:r,loginType:S,pwd:n,uid:f,orgNumber:k,deviceId:E,OS:P,version:N,OTP:t},dataType:"json",success:function(t){0==t.loginUser.returnFlag?(t.loginUser.pwd=n,t.loginUser.loginName=r,t.loginUser.loginType=S,h=t.loginUser,b.rsaEncrypt(e,function(e){var r={cust_id:pbE.SYS().getPublicData("user_id"),original_password:e.original_password,login_password:e.login_password,login_password_twice:e.login_password_twice};m.resetPasswordByUserId(r,function(e){0==e.error_no?(setTimeout(function(){pbE.SYS().sendMessageToNative("PbKey_H5_Home_Auth_Data",JSON.stringify(h))},100),window.location.href="goBack"):e.error_no==-10040?alert("请输入正确的登录密码"):alert(e.error_info)})})):8==t.loginUser.returnFlag?alert("校验码错误，请重新获取"):11==t.loginUser.returnFlag?alert("该用户尚未注册"):alert("发送失败，请稍后重试")},error:function(){alert("连接超时，请检查网络后重试")}})}function a(e){return 0==I?(e.text("获取验证码"),void e.attr("class","code_btn")):(e.attr("class","code_btn1"),e.text("重新发送("+I+")"),I--,void(_=setTimeout(function(){a(e)},1e3)))}function l(){clearTimeout(_)}function s(){}function d(){}var g="#userInfo_updatePassword ";e("2.0.0/js/plugins/validator/scripts/validatorUtils");var f,u,c,p,v,h,_,b=e("commonExt"),m=e("futures/services/userService").getInstance(),w="https://pbmobile.pobo.net.cn/pobocertification_WebService/",S="1",y="123",E="127.0.0.1",P="iOS",N="1.0.0",k="789",T="undefined"!=typeof pbE,I=60,A={init:n,bindPageEvent:o,destroy:l,pageBack:s,load:d};t.exports=A});