define("futures/scripts/register.js",function(e,t,i){function r(){if(x&&(m=pbE.HQ(),p=pbE.SYS(),h=pbE.ZX(),_=pbE.INFO()),"undefined"!=typeof pbE){var e=pbE.SYS().getDeviceJsonInfo();if(e){var t=JSON.parse(e);if(t[71]&&(S=t[71]),t[255]){var i=t[255];"2"==i?P="iOS":"3"==i&&(P="Android")}t[73]&&(U=t[73]),t.jgid&&(N=t.jgid)}}o()}function n(){$.bindEvent($(u+" .icon_back"),function(){window.location.href="goBack"}),$.bindEvent($(u+" #mobile , #graphical"),function(){var e=$.trim($(u+"#graphical").val());$.validatorUtils.isMobile($.trim($(u+" #mobile").val()))?e.length<4?$(u+" #message_code_btn").attr("class","code_btn1"):"获取验证码"==$(u+" #message_code_btn").text()&&$(u+" #message_code_btn").attr("class","code_btn"):$(u+" #message_code_btn").attr("class","code_btn1")},"change"),$.bindEvent($(u+" #captcha_img"),function(){o()}),$.preBindEvent($(u+" .input_text"),".code_btn",function(e){a()}),$.bindEvent($(u+"#register_btn"),function(){var e=$.trim($(u+" #login_pwd").val()),t=$.trim($(u+" #re_login_pwd").val());if(!$.validatorUtils.isMobile($.trim($(u+" #mobile").val())))return void alert("请输入正确的手机号");if(!$.validatorUtils.isNotEmpty($.trim($(u+" #message").val())))return void alert("短信验证码不能为空");if(e.length<7&&e.length>20)return void alert("登录密码必须是8-20位字母和数字的组合");if(e.length<8||e.length>20)return 0==e.length?void alert("登录密码不能为空"):void alert("登录密码必须是8-20位字母和数字的组合");for(var i=0,r=0;r<e.length;r++)if(e[r].match(/^[a-zA-z]+$/)){i+=1;break}for(var r=0;r<e.length;r++)if(e[r].match(/^\d+$/)){i+=1;break}if(2!=i)return void alert("登录密码只能是数字和字母组合");if(t.length<7&&t.length>20)return void alert("确认密码必须是8-20位字母和数字的组合");if(t.length<7||t.length>20)return 0==t.length?void alert("确认密码不能为空"):void alert("确认密码必须是8-20位字母和数字的组合");for(var i=0,r=0;r<t.length;r++)if(t[r].match(/^[a-zA-z]+$/)){i+=1;break}for(var r=0;r<t.length;r++)if(t[r].match(/^\d+$/)){i+=1;break}return 2!=i?void alert("登录密码只能是数字和字母组合"):void(e==t?d():alert("两次密码不一致"))})}function o(){$(u+"#captcha_img").attr("src",$.config.global.imagePath+"?r="+(new Date).getTime())}function a(){if($.validatorUtils.isMobile($.trim($(u+" #mobile").val()))){var e={mobile_phone:$(u+" #mobile").val(),type:"1"};T.CheckPhoneNumber(e,function(e){if("0"==e.error_no){var t=e.results;"0"==t[0].is_exist?l():(o(),alert("该手机号码已注册，请使用其他号码"))}},{isShowWait:!1})}else alert("请输入正确的手机号"),o()}function l(){var e=$.trim($(u+"#graphical").val());if($.validatorUtils.isNotEmpty(e)){var t={ticket:e};T.CheckGraphicalCode(t,function(e){"0"==e.error_no?($(u+" #message_code_btn").attr("class","code_btn"),$.ajax({type:"POST",url:k+"firstregister",data:{poboNumber:w,loginName:$(u+" #mobile").val(),loginType:y,deviceId:S,pwd:"",FatherAccount:O,OS:P,version:U,orgNumber:N},dataType:"json",success:function(e){return 0!=e.loginUser.returnFlag?void alert("短信发送失败，请稍后再试"):(j=60,void s($(u+" #message_code_btn")))},error:function(){alert("连接超时，请检查网络后重试")}})):(alert(e.error_info),o())},{isShowWait:!1})}else alert("请输入正确的图形验证码")}function c(){if(!$.validatorUtils.isMobile($.trim($(u+" #mobile").val())))return $(u+" #message_code_btn").attr("class","code_btn1"),!1;var e=$.trim($(u+"#graphical").val());return $.validatorUtils.isNotEmpty(e)&&4==e.length?void $(u+" #message_code_btn").attr("class","code_btn"):($(u+" #message_code_btn").attr("class","code_btn1"),!1)}function s(e){return 0==j?(c(),void e.text("获取验证码")):(e.attr("class","code_btn1"),e.text("重新发送("+j+")"),j--,void setTimeout(function(){s(e)},1e3))}function d(){var e={pwd:$.trim($(u+" #login_pwd").val())},t=$.trim($(u+" #mobile").val()),i=$.trim($("#message").val()),r=$.trim($(u+" #login_pwd").val());$.ajax({type:"POST",url:k+"checkRegister",data:{poboNumber:w,loginName:t,loginType:y,OTP:i,deviceId:S,pwd:r,orgNumber:N},dataType:"json",success:function(i){console.log(i),8==i.checkOTP.returnFlag?alert("校验码错误，请重新获取"):0!=i.checkOTP.returnFlag&&5!=i.checkOTP.returnFlag||(i.checkOTP.pwd=t.substr(-6),i.checkOTP.loginName=t,i.checkOTP.loginType=y,E=i.checkOTP,f.rsaEncrypt(e,function(e){var t={mobile_phone:$.trim($(u+" #mobile").val()),login_password:e.pwd};T.registerUser(t,function(e){"0"==e.error_no?(setTimeout(function(){pbE.SYS().sendMessageToNative("PbKey_H5_Home_Auth_Data",JSON.stringify(E))},1e3),window.location.href="close"):alert(e.error_info)})}))},error:function(){alert("连接超时，请检查网络后重试")}})}function v(){}function g(){}function b(){}var u="#register ",f=(e("common"),e("commonExt"));e("2.0.0/js/plugins/validator/scripts/validatorUtils");var m,p,_,h,E,T=e("futures/services/userService").getInstance(),k="https://pbmobile.pobo.net.cn/pobocertification_WebService/",w="123",y="1",S="127.0.0.1",N="789",O="pobo",P="Android",U="1.0.0.1",x="undefined"!=typeof pbE,j=60,A={init:r,bindPageEvent:n,destroy:v,pageBack:g,load:b};i.exports=A});