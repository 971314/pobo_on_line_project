function decimalDec(o,i){i+="";var t=i.indexOf("."),e=i.length;return i=t>=0&&e-1-t>=o+1?i.substr(0,i.indexOf(".")+o+2):(i-0).toFixed(o+1)}function decimalDecPrice(o,i){i+="";var t=i.indexOf("."),e=i.length;return i=t>=0&&e-1-t>=o?i.substr(0,i.indexOf(".")+o+1):(i-0).toFixed(o)}function tradePart(o,i){var t=pbE.WT().wtQueryStockRe(o);if(t)if(position=JSON.parse(t).data,position.length>0){var e={},a=[],s=[];marketInfo=[];for(var n=0;n<position.length;n++){position[n].flag=0;var r=position[n][54],p=position[n][63],l=0;marketInfo=JSON.parse(pbE.WT().wtGetHQInfo(p,r)),p.indexOf("&")>=0&&(l=1),marketInfo.HQCode&&marketInfo.HQMarket&&!isNaN(position[n][136])&&!l||(position[n].flag=1);var f=pbE.HQ().hqGetPriceRate(marketInfo.HQCode,marketInfo.HQMarket),c=pbE.WT().wtGetMSSL(p,r);position[n][2]=position[n][136]-0,position[n][3]=position[n][135]-0,position[n][4]=f,position[n][5]=c,s.indexOf(marketInfo.HQCode)<0&&(s.push(marketInfo.HQCode),a.push({2:marketInfo.HQMarket,3:marketInfo.HQCode})),position[n].name=marketInfo.HQName||"",position[n].market=marketInfo.HQMarket,position[n].code=marketInfo.HQCode,position[n].groupflag=pbE.HQ().hqGetGroupFlag(marketInfo.HQCode,marketInfo.HQMarket),position[n].decimal=pbE.HQ().hqGetPriceDecimal(marketInfo.HQCode,marketInfo.HQMarket),position[n][136]=decimalDec(position[n].decimal,position[n][136]),position[n].available=position[n][137],position[n].flag?position[n].flag&&(position[n].profit="--",position[n].price="--"):(position[n].price=pbE.HQ().hqGetNowPrice(marketInfo.HQCode,marketInfo.HQMarket),position[n].base=pbE.HQ().hqGetLastBasePrice(marketInfo.HQCode,marketInfo.HQMarket),position[n].price&&!isNaN(position[n].price)?(position[n].profit=((position[n].price-position[n][136]-0).toFixed(4)-0)*position[n][135]*c,"1"==position[n][112]&&(position[n].profit=0-position[n].profit),position[n].profit=(position[n].profit-0).toFixed(2)):position[n].base&&!isNaN(position[n].base)&&(position[n].profit=((position[n].base-position[n][136]-0).toFixed(4)-0)*position[n][135]*c,"1"==position[n][112]&&(position[n].profit=0-position[n].profit),position[n].profit=(position[n].profit-0).toFixed(2),position[n].price="--"),calcProfit(position,n,c))}position.sort(firstBy(function(o){return o[63].toUpperCase()}).thenBy("112").thenBy("503")),ReactDOM.render(React.createElement(PositionContentsFutures,{contents:position}),document.getElementById("contents"));var d=!1;totalPL=0,sumPl=0;for(var n=0,u=position.length;n<u;n++)"undefined"==typeof position[n].dayPl||isNaN(position[n].dayPl)?position[n].flag:(totalPL+=position[n].dayPl-0,d=!0);d&&(plFlag=1,close&&(closePl-=0,totalPL-=0,sumPl=(closePl+totalPL-0).toFixed(2),$("#float").html(sumPl+"元"))),e[1]=a,e[7]="1",pbE.HQ().hqSubscribe(0,JSON.stringify(e))}else position.length<=0&&(pbE.SYS().stopLoading(),plFlag=1,totalPL=0,$("#contents").empty(),closePl&&$("#float").html((closePl-0).toFixed(2)+"元"))}function calcProfit(o,i,t){var e=o[i];"1"==e[503]?e.price&&!isNaN(e.price)&&"--"!=e.price?(e.dayPl=((e.price-e[136]-0).toFixed(4)-0)*e[135]*t,"1"==e[112]&&(e.dayPl=0-e.dayPl)):"--"==e.price&&(e.dayPl=0):"2"==e[503]?e.price&&!isNaN(e.price)&&"--"!=e.price&&e.base&&!isNaN(e.base)?(e.dayPl=((e.price-e.base-0).toFixed(4)-0)*e[135]*t,"1"==e[112]&&(e.dayPl=0-e.dayPl)):"--"==e.price&&(e.dayPl=0):"0"==e[503]&&(e[1101]==e[135]?e.price&&!isNaN(e.price)&&"--"!=e.price?(e.dayPl=((e.price-e[1102]-0).toFixed(4)-0)*e[1101]*t,"1"==e[112]&&(e.dayPl=0-e.dayPl)):"--"==e.price&&(e.dayPl=0):e[1101]<e[135]&&(e.price&&!isNaN(e.price)&&"--"!=e.price&&e.base&&!isNaN(e.base)?(e.dayPl=((e.price-e[1102]-0).toFixed(4)-0)*e[1101]*t+((e.price-e.base-0).toFixed(4)-0)*(e[135]-e[1101]-0)*t,"1"==e[112]&&(e.dayPl=0-e.dayPl)):"--"==e.price&&(e.dayPl=0)))}function hqPart(o){hasSubscribe=!0;for(var i=o.jData.Data,t=0,e=0,a=0,s=position.length;a<s;a++)if(position[a].flag)position[a].flag&&(position[a].profit="--",position[a].price="--");else for(var n=0,r=i.length;n<r;n++){position[a].code==i[n][10]&&(position[a].base=pbE.HQ().hqGetLastBasePrice(position[a].code,position[a].market),i[n][29]&&!isNaN(i[n][29])?(t=(i[n][29]-0)/position[a][4],e=((t-position[a][2]).toFixed(4)-0)*position[a][3]*position[a][5],"1"==position[a][112]&&(e=0-e),t=decimalDecPrice(position[a].decimal,t),position[a][7]=e,position[a].profit=e,position[a].price=t,position[a].profit=(position[a].profit-0).toFixed(2),calcProfit(position,a,position[a][5])):(position[a].dayPl=0,position[a].price="--",position[a].base&&!isNaN(position[a].base)?(position[a].profit=((position[a].base-position[a][136]-0).toFixed(4)-0)*position[a][135]*position[a][5],"1"==position[a][112]&&(position[a].profit=0-position[a].profit),position[a].profit=(position[a].profit-0).toFixed(2)):position[a].profit="--"),setPrice(position[a]));break}var l=!1;totalPL=0,sumPl=0;for(var a=0,s=position.length;a<s;a++)"undefined"==typeof position[a].dayPl||isNaN(position[a].dayPl)?position[a].flag:(totalPL+=position[a].dayPl-0,l=!0);l&&(plFlag=1,p++,close&&(sumPl=(totalPL-0+(closePl-0)-0).toFixed(2),1==p&&pbE.SYS().stopLoading()),sumPl&&0!=sumPl&&$("#float").html(sumPl+"元"))}function setPrice(o){var i="#"+o.code+"_"+o[112]+"_"+o[503];isNaN(o.profit)?($(i).removeClass("redbar"),$(i).removeClass("greenbar"),$(i+" .profit").html(o.profit),$(i+" .profit").removeClass("a3").removeClass("a4").addClass("a1")):o.profit>0?($(i).removeClass("greenbar"),$(i).addClass("redbar"),$(i+" .profit").removeClass("a1").removeClass("a4").addClass("a3"),$(i+" .profit").html("+"+o.profit)):o.profit<0?($(i).removeClass("redbar"),$(i).addClass("greenbar"),$(i+" .profit").removeClass("a1").removeClass("a3").addClass("a4"),$(i+" .profit").html(o.profit)):0==o.profit&&($(i).removeClass("redbar"),$(i).removeClass("greenbar"),$(i+" .profit").html(o.profit),$(i+" .profit").removeClass("a3").removeClass("a4").addClass("a1")),$(i+" .price").html(o.price)}"undefined"==typeof pbE&&(window.pbE={WT:function(){var o={wtGetCurrentConnectionCID:function(){},wtQueryMoney:function(){},wtQueryMoneyRe:function(){var o={moduleId:90002,functionNO:6012,jData:{data:[{102:10,182:20,97:30,152:111,111:10,63:"GTF"}]}};callback(JSON.stringify(o)),$("#float").html("1026元")},wtQueryStockRe:function(){}};return o},SYS:function(){var o={startLoading:function(){}};return o}});var marketInfo,totalPL,position,stockInfo=[],p=0,asset,refreshFlag=1,CID=pbE.WT().wtGetCurrentConnectionCID(),closePl,sumPl,close=0,plFlag=0;$(function(){var o={callbacks:[{fun:6012,module:90002,callback:function(o){if(asset=o.jData.data[0],close=1,closePl=asset[102]-0,asset[97]=(asset[97]-0).toFixed(2),asset[152]=(asset[152]-0).toFixed(2),asset[111]=(asset[111]-0).toFixed(2),plFlag)asset.sumPl=(totalPL-0+(closePl-0)-0).toFixed(2);else{var i=$("#float").html();asset.sumPl=i.substring(0,i.length-1)}ReactDOM.render(React.createElement(FundsInfoFutures,{info:asset}),document.getElementById("fund"))}},{fun:56004,module:90002,callback:function(o){o.reservId==CID&&5==o.jData[223]&&(refreshFlag||(pbE.SYS().stopLoading(),refreshFlag=1),fresh())}},{fun:56005,module:90002,callback:function(o){o.reservId==CID&&pbPage.fresh()}},{fun:56006,module:90002,callback:function(o){o.reservId==CID&&pbPage.fresh()}},{fun:56014,module:90002,callback:function(o){o.reservId==CID&&pbPage.fresh()}},{module:9e4,callback:function(o){totalPL=0,hqPart(o)}}],reload:function(){close=0,plFlag=0,CID=pbE.WT().wtGetCurrentConnectionCID(),p=0,tradePart(CID,!0),pbE.WT().wtQueryMoney(CID,JSON.stringify({}))},refresh:function(){close=0,plFlag=0,pbE.SYS().startLoading(),refreshFlag=0,pbE.WT().wtQueryMoney(CID,JSON.stringify({})),pbE.WT().wtSynFlash(CID)},fresh:function(){close=0,plFlag=0,p=0,tradePart(CID,!0),pbE.WT().wtQueryMoney(CID,JSON.stringify({}))},doShow:function(o){o||pbApi.sys_stopLoading()}};pbPage.initPage(o);var i=pbE.WT().wtQueryMoneyRe(CID);if(i){var t=JSON.parse(i).data[0];t[97]=(t[97]-0).toFixed(2),t[152]=(t[152]-0).toFixed(2),t[111]=(t[111]-0).toFixed(2),t.sumPl="--",ReactDOM.render(React.createElement(FundsInfoFutures,{info:t}),document.getElementById("fund"))}p=0,pbE.SYS().startLoading(),tradePart(CID,!0),pbE.WT().wtQueryMoney(CID,JSON.stringify({}))});