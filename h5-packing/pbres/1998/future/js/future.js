function fresh(){close=0,plFlag=0,pbE.WT().wtQueryMoney(CID,JSON.stringify({})),tradePart(CID)}function refresh(){close=0,plFlag=0,pbE.SYS().startLoading(),refreshFlag=0,pbE.WT().wtQueryMoney(CID,JSON.stringify({})),pbE.WT().wtSynFlash(CID)}function tradePart(t){var o=pbE.WT().wtQueryStockRe(t);if(o){var a=JSON.parse(o).data;if(a.length>0){symbolData={},marketData=[],unique=[],stockInfo=[],marketInfo=[];for(var e=0;e<a.length;e++){var n=a[e][54],s=a[e][63],l={},i=0;if(marketInfo=JSON.parse(pbE.WT().wtGetHQInfo(s,n)),s.indexOf("&")>=0&&(i=1),marketInfo.HQCode&&marketInfo.HQMarket&&!isNaN(parseFloat(a[e][136]))&&!i){var r=pbE.HQ().hqGetPriceRate(marketInfo.HQCode,marketInfo.HQMarket),c=pbE.WT().wtGetMSSL(s,n);base=pbE.HQ().hqGetLastBasePrice(marketInfo.HQCode,marketInfo.HQMarket),l[1]=marketInfo.HQCode,l[2]=a[e][136]-0,l[3]=a[e][135]-0,l[4]=r,l[5]=c,l[6]=a[e][112],l[8]=base,l[9]=marketInfo.HQMarket,l[10]=a[e][503],l[11]=a[e][1101],l[12]=a[e][1102],stockInfo.push(l),unique.indexOf(marketInfo.HQCode)<0&&(unique.push(marketInfo.HQCode),marketData.push({2:marketInfo.HQMarket,3:marketInfo.HQCode}))}}symbolData[1]=marketData,symbolData[7]="1",pbE.HQ().hqSubscribe(0,JSON.stringify(symbolData))}else if(a.length<=0&&(pbE.SYS().stopLoading(),stockInfo=[],plFlag=1,totalPL=0,close)){var f=closePl-0;f>0?($("#total-PL").removeClass(),$("#total-PL").addClass("c3"),$("#total-PL").html("+"+f+"元")):f<0?($("#total-PL").removeClass(),$("#total-PL").addClass("c4"),$("#total-PL").html(f+"元")):($("#total-PL").removeClass(),$("#total-PL").addClass("c1 bolder"),$("#total-PL").html("0元"))}}}function hqPart(t){for(var o=t.jData.Data,a=0,e=stockInfo.length;a<e;a++)for(var n=0,s=o.length;n<s;n++)if(stockInfo[a][1]==o[n][10]){o[n][29]&&!isNaN(o[n][29])?(stockInfo[a].price=(o[n][29]-0)/stockInfo[a][4],stockInfo[a][8]=pbE.HQ().hqGetLastBasePrice(stockInfo[a][1],stockInfo[a][9]),"1"==stockInfo[a][10]?stockInfo[a].price&&!isNaN(stockInfo[a].price)&&(stockInfo[a].dayPl=((stockInfo[a].price-stockInfo[a][2]-0).toFixed(4)-0)*stockInfo[a][3]*stockInfo[a][5],"1"==stockInfo[a][6]&&(stockInfo[a].dayPl=0-stockInfo[a].dayPl)):"2"==stockInfo[a][10]?stockInfo[a].price&&!isNaN(stockInfo[a].price)&&stockInfo[a][8]&&!isNaN(stockInfo[a][8])&&(stockInfo[a].dayPl=((stockInfo[a].price-stockInfo[a][8]-0).toFixed(4)-0)*stockInfo[a][3]*stockInfo[a][5],"1"==stockInfo[a][6]&&(stockInfo[a].dayPl=0-stockInfo[a].dayPl)):"0"==stockInfo[a][10]&&(stockInfo[a][11]==stockInfo[a][3]?stockInfo[a].price&&!isNaN(stockInfo[a].price)&&(stockInfo[a].dayPl=((stockInfo[a].price-stockInfo[a][12]-0).toFixed(4)-0)*stockInfo[a][11]*stockInfo[a][5],"1"==stockInfo[a][6]&&(stockInfo[a].dayPl=0-stockInfo[a].dayPl)):stockInfo[a][11]<stockInfo[a][3]&&stockInfo[a].price&&!isNaN(stockInfo[a].price)&&stockInfo[a][8]&&!isNaN(stockInfo[a][8])&&(stockInfo[a].dayPl=((stockInfo[a].price-stockInfo[a][12]-0).toFixed(4)-0)*stockInfo[a][11]*stockInfo[a][5]+((stockInfo[a].price-stockInfo[a][8]-0).toFixed(4)-0)*(stockInfo[a][3]-stockInfo[a][11]-0)*stockInfo[a][5],"1"==stockInfo[a][6]&&(stockInfo[a].dayPl=0-stockInfo[a].dayPl)))):stockInfo[a].dayPl=0,stockInfo[a][7]=stockInfo[a].dayPl;break}var l=!1;totalPL=0,sumPl=0;for(var a=0,e=stockInfo.length;a<e;a++){if("undefined"==typeof stockInfo[a][7]||isNaN(stockInfo[a][7])){l=!1;break}totalPL+=stockInfo[a][7]-0,l=!0}l&&(plFlag=1,close&&(sumPl=(totalPL-0+(closePl-0)).toFixed(2),sumPl>0?($("#total-PL").removeClass(),$("#total-PL").addClass("c3"),$("#total-PL").html("+"+sumPl+"元")):sumPl<0?($("#total-PL").removeClass(),$("#total-PL").addClass("c4"),$("#total-PL").html(sumPl+"元")):($("#total-PL").removeClass(),$("#total-PL").addClass("c1 bolder"),$("#total-PL").html("0元"))))}function callback(t){var o=JSON.parse(t);if(90002==o.moduleId)if(6012==o.functionNO){pbE.SYS().stopLoading();var a=o.jData.data[0];close=1,closePl=a[102]-0,plFlag&&(sumPl=(totalPL-0+(closePl-0)).toFixed(2),sumPl>0?($("#total-PL").removeClass(),$("#total-PL").addClass("c3"),$("#total-PL").html("+"+sumPl+"元")):sumPl<0?($("#total-PL").removeClass(),$("#total-PL").addClass("c4"),$("#total-PL").html(sumPl+"元")):($("#total-PL").removeClass(),$("#total-PL").addClass("c1 bolder"),$("#total-PL").html("0元"))),unit=getUnit(a[56]),a[97]=pbUtils.doubleToStr(a[97]),a[152]=pbUtils.doubleToStr(a[152]),a[111]=pbUtils.doubleToStr(a[111]),$("#total-asset").html(a[97]+unit),$("#guarantee").html(a[152]+unit),(a[345]+"").indexOf("%")>=0?$("#risk").html(a[345]):$("#risk").html(pbUtils.doubleToPecent(a[345])),$("#available").html(a[111]+unit)}else 56004==o.functionNO&&o.reservId==CID?5==o.jData[223]&&(refreshFlag||(pbE.SYS().stopLoading(),refreshFlag=1),fresh()):56005==o.functionNO&&o.reservId==CID?fresh():56006==o.functionNO&&o.reservId==CID?fresh():56014==o.functionNO&&o.reservId==CID&&fresh();else 9e4==o.moduleId&&(totalPL=0,hqPart(o))}function reload(){close=0,plFlag=0,pbE.SYS().startLoading(),CID=pbE.WT().wtGetCurrentConnectionCID(),loginInfo=JSON.parse(pbE.WT().wtLoginRe(CID)),$("#accnum").html(loginInfo.data[0][51]),reg.test(loginInfo.data[0][74].substr(0,1))?$("#name").addClass("hide"):($("#name").removeClass("hide"),$("#name").html(loginInfo.data[0][74].substr(0,1)+"先生/女士")),pbE.WT().wtQueryMoney(CID,JSON.stringify({})),tradePart(CID)}function doShow(t){t||pbE.SYS().stopLoading()}function process(t){var o=t.index,a="";o.stacked.forEach(function(t){if(void 0==t.url)if(void 0==t.menu)a+="<li><a>"+t.name+"</a></li>";else{a+="<li><a>"+t.name+"<img class='more' src='images/more.png' alt='详细'></a></li><ul class='hide'>";for(var o=0;o<t.menu.length;o++)a+=void 0==t.menu[o].tip?"<li><a href='"+t.menu[o].url+"' id='tip'>"+t.menu[o].name+"</a></li>":"<li><a href='"+t.menu[o].url+"' id='tip'>"+t.menu[o].name+"<span class='tip'>"+t.menu[o].tip+"</span></a></li>";a+="</ul>"}else if(void 0==t.menu)a+="<li><a href='"+t.url+"' id='tip'>"+t.name+"</a></li>";else{a+="<li><a>"+t.name+"<img class='more' src='images/more.png' alt='详细'></a></li><ul class='hide'>";for(var o=0;o<t.menu.length;o++)a+=void 0==t.menu[o].tip?"<li><a href='"+t.menu[o].url+"' id='tip'>"+t.menu[o].name+"</a></li>":"<li><div><a href='"+t.menu[o].url+"'  id='tip'>"+t.menu[o].name+"</a><span class='tip'>"+t.menu[o].tip+"</span></div></li>";a+="</ul>"}}),$(".nav-stacked").html(a),$(".nav-stacked>li").each(function(t,o){$(o).on("click",function(){$(this).next("ul").toggleClass("hide"),$(this).next("ul").is(".hide")?$(this).find("img").attr("src","images/more.png").css({width:"7px",height:"16px"}):$(this).find("img").attr("src","images/arrow-down.png").css({width:"auto",height:"auto"})})})}var isApp="undefined"!=typeof pbE;"undefined"==typeof pbE&&(window.pbE={WT:function(){var t={wtGetCurrentConnectionCID:function(){},wtQueryStockRe:function(){},wtGetHQInfo:function(){},wtSynFlash:function(){},wtQueryMoney:function(){var t={moduleId:90002,functionNO:6012,jData:{data:[{56:0,97:99999999,111:98797987,152:3453543,345:"32",182:1499,102:123}],223:5}};callback(JSON.stringify(t))},wtGetMSSL:function(){},wtLoginRe:function(){return'{"data":[{"51":123,"74":"刘"}]}'}};return t},SYS:function(){var t={stopLoading:function(){},startLoading:function(){}};return t},HQ:function(){var t={hqGetPriceRate:function(){},hqGetLastBasePrice:function(){},hqSubscribe:function(){}};return t}},$("#total-PL").removeClass(),$("#total-PL").addClass("c3"),$("#total-PL").html("+888888元"));var symbolData={},marketData=[],stockInfo=[],unique=[],unit,marketInfo,totalPL=0,refreshFlag=1,CID=pbE.WT().wtGetCurrentConnectionCID(),closePl,close=0,plFlag=0,sumPl=0;pbE.SYS().startLoading();var loginInfo=JSON.parse(pbE.WT().wtLoginRe(CID));$("#accnum").html(loginInfo.data[0][51]);var reg=new RegExp("^[A-Za-z]+$");reg.test(loginInfo.data[0][74].substr(0,1))?$("#name").addClass("hide"):($("#name").removeClass("hide"),$("#name").html(loginInfo.data[0][74].substr(0,1)+"先生/女士")),pbE.WT().wtQueryMoney(CID,JSON.stringify({})),isApp?process(JSON.parse(pbE.SYS().readConfig("future/conf/future.json"))):$.get("conf/future.json",process),tradePart(CID);