function decimalDecPrice(e,t){t+="";var a=t.indexOf("."),n=t.length;return a>=0&&n-1-a>=e?t.substr(0,t.indexOf(".")+e+1):(t-0).toFixed(e)}function showCon(e){var t,a=mainConfig.contracts;if(isPoboApp){var n,r=a.showType;if(!e&&1!=r)return;if(n=1==r?pbHQ.getHQDetailRecentBrowe(HISTORY):2==r?pbZX.getSelfStock(SELF):pbHQ.getHQZLHY(HOT)){if(n=JSON.parse(n),n.length>0&&n.length<3){t=JSON.parse(pbHQ.getHQZLHY(6));for(var c=t.length-1;c>=0;c--){for(var o=!1,i=0;i<n.length;i++)if(t[c].code==n[i].code){o=!0;break}if(o||n.unshift(t[c]),3==n.length)break}}n.length>0&&(t=n)}else n=pbHQ.getHQZLHY(HOT),t=JSON.parse(n)}if(t&&0!=t.length){if(!contract||contract.length!=t.length){for(var s='<div class="area clearfix">',c=0;c<t.length;c++)c%3==0&&(s+='<div class="div-float clearfix">'),s+='<div class="col-xs-4 market text-center"><a id="market-href-'+c+'"><p class="e1"><span id="market-name-'+c+'" class="market-name"></span></p><p class="a1 m" id="market-price-'+c+'"><img src=""> <span>--</span></p><p class="e1 m" id="market-chg-'+c+'"><span>--</span>&nbsp;&nbsp;<span>--</span></p></a></div>',c%3!=2&&c!=t.length-1||(s+="</div>");s+="</div>",$("#market").html(s)}var l=Math.ceil(t.length/3);market={group:{},pageCount:l,current:0,next:0,last:0};for(var c=0;c<t.length;c++){var m=Math.floor(c/3),u={2:t[c].market,3:t[c].code};if(market.group[m]?market.group[m].push(u):market.group[m]=[u],!isPoboApp){$("#market-name-"+c).html(t[c].name);var i=c%3;1!=i&&($("#market-href-"+c).addClass(i<1?"down":"up"),$("#market-price-"+c+" img").attr("src","../images/"+(i<1?"low":"high")+".png")),$("#market-price-"+c+" span").html(decimalDecPrice(4,Math.random()));var d=$("#market-chg-"+c+" span");d[0].innerHTML=decimalDecPrice(2,Math.random())*(i-1),d[1].innerHTML=decimalDecPrice(2,Math.random())*(i-1)+"%"}}contract=t,market.current=0,isPoboApp&&pbHQ.hqSubscribe(0,JSON.stringify({1:market.group[0]}));var p=document.documentElement.clientWidth;$("#market .area>div").css({width:p}),l<2?$("#market .area").attr("style",""):$("#market .area").css("width",p*l),marketScroll&&marketScroll.destroy(),l>1&&(marketScroll=new IScroll("#market",{eventPassthrough:!0,scrollX:!0,scrollY:!1,preventDefault:!1,snap:".div-float",tap:!0,mouseWheelSpeed:10}),marketScroll.on("scrollEnd",function(){market.current=marketScroll.currentPage.pageX,marketScroll.currentPage.pageX+1>=l?market.next=0:market.next=marketScroll.currentPage.pageX+1;var e=market.group[market.current].concat(market.group[market.next]);pbHQ.hqSubscribe(0,JSON.stringify({1:e}))}),market.next=1,pbHQ.hqSubscribe(0,JSON.stringify({1:market.group[market.current].concat(market.group[market.next])}))),setMarketInterval(!0)}}function setMarketInterval(e){e?(contractInterval&&(clearInterval(contractInterval),contractInterval=null),contractInterval=setInterval(function(){1!=market.pageCount&&(marketScroll.currentPage.pageX+1>=market.pageCount?(market.last=marketScroll.currentPage.pageX,marketScroll.goToPage(0,0,10)):(market.last=marketScroll.currentPage.pageX,marketScroll.next(10)))},5e3)):(clearInterval(contractInterval),contractInterval=null)}function processCustom(){var e=mainConfig.customs,t=e;if(isPoboApp)if(pbSYS.isHasLocalFile("main",1))if(t=pbSYS.readLocalFile("main",1)){if(t=JSON.parse(t),null==t.isReplace||t.isReplace)prevCustom=null,pbSYS.writeLocalFile("main",1,JSON.stringify(t=e));else if(t.version!=e.version){t.version=e.version;for(var a={},n={},r=0;r<t.contents.length;r++)a[t.contents[r].id]=t.contents[r];for(var r=0;r<e.contents.length;r++)n[e.contents[r].id]=e.contents[r],a[e.contents[r].id]||(e.contents[r].checked="0",t.contents.push(e.contents[r]));for(var c=0;c<t.contents.length;c++){var o=t.contents[c],i=n[o.id];i?(o.title=i.title,o.image1=i.image1,o.image2=i.image2,o.url=i.url):t.contents.splice(c,1)}pbSYS.writeLocalFile("main",1,JSON.stringify(t))}}else pbSYS.writeLocalFile("main",1,JSON.stringify(t=e));else pbSYS.writeLocalFile("main",1,JSON.stringify(t=e));for(var s=[],r=0;r<t.contents.length;r++)"1"==t.contents[r].checked&&s.push(t.contents[r]);var l=s.length,m=Math.ceil((l+1)/8);if(prevCustom&&prevCustom.length==l){for(var r=0;r<l&&prevCustom[r].id==s[r].id;r++);if(r==l)return}prevCustom=s,ReactDOM.render(React.createElement(CustButton,{button:s}),document.getElementById("customized"));var u=$("#indicator"),d="";if(m>1)for(var r=0;r<m;r++)d+="<li"+(r?"":' class="ind"')+"></li> ";u.html(d);var p=document.documentElement.clientWidth;$("#customized .area>div").css({width:p}),m<2?$("#customized .area").attr("style",""):$("#customized .area").css("width",p*m),navScroll&&navScroll.destroy(),m>1&&(u=u.find("li"),navScroll=new IScroll("#customized",{eventPassthrough:!0,scrollX:!0,scrollY:!1,preventDefault:!1,snap:".btn-wrap",tap:!0,mouseWheelSpeed:10}),navScroll.on("scrollEnd",function(){u.removeClass().eq(Math.floor(-this.x/p)).addClass("ind")}))}function queryNews(e){if(isPoboApp)pbINFO.infoQueryListWithJson(JSON.stringify({type:"mu",groupIDs:e.ids,doc:"json",count:e.count}));else{for(var t={gcount:e.ids.length,count:e.count},a=0;a<t.gcount;a++)t["group"+(a+1)]=e.ids[a];$.get(mainConfig.news.webservice,t,function(t){newsData[newsCurrent]=JSON.parse(t).Indexes.slice(0,e.count),ReactDOM.render(React.createElement(InfoList,{contents:newsData[newsCurrent]}),document.getElementById("info-list"))})}}function processFirst(e,t){var a=e.banners,n=$("#carousel-example-generic");if(!t||t.banners.version!=a.version)if(a.isShow){n.show();var r="",c="";a.data.forEach(function(e,t){r+="<a class='item"+(t?"":" active")+"'"+(e.url?" href='"+e.url+"'":"")+"><img src='"+e.img+"'/></a>",c+="<li data-target='#carousel-example-generic' data-slide-to='"+t+"'"+(t?"":" class='active'")+"></li> "}),window.bannersInit?(n.carousel({interval:2e3}),setTimeout(function(){n.find(".carousel-inner").html(r),n.find(".carousel-indicators").html(c),n.carousel("cycle")},1e3)):(n.find(".carousel-inner").html(r),n.find(".carousel-indicators").html(c),bannersInit=!0)}else n.hide()}function processConfig(e,t){if(mainConfig&&(prevConfig=mainConfig),mainConfig=e,prevConfig&&prevConfig.version!=e.version)return void location.reload();if(t&&processFirst(e,prevConfig),e.contracts.isShow?($("#market").show(),showCon(t)):($("#market").hide(),contractInterval&&(clearInterval(contractInterval),contractInterval=null)),e.customs.isShow?($("#customContainer").show(),processCustom()):$("#customContainer").hide(),cfg=e.news,container=$("#info"),!prevConfig||prevConfig.news.version!=cfg.version)if(cfg.isShow){container.show();var a="";cfg.data.forEach(function(e){a+="<i>"+e.name+"</i>"}),container.find(".area-title span").html(a),newsCurrent=0,cfg.data.length>1&&container.find(".area-title i").on("click",function(){var e=$(this),t=e.index();e.addClass("active").siblings().removeClass(),newsCurrent=t,newsData[t]?ReactDOM.render(React.createElement(InfoList,{contents:newsData[t],dir:"pobo:uncheck=0&info/"}),document.getElementById("info-list")):queryNews(cfg.data[t])}).eq(0).addClass("active")}else container.hide();cfg.isShow&&cfg.data.length>0&&(newsData=[],queryNews(cfg.data[newsCurrent]))}function doReload(e){isPoboApp?processConfig(JSON.parse(pbSYS.readConfig("main/conf/main.json")),e):$.get("conf/main.json?"+Date.now(),function(t){processConfig(t,e)})}var HISTORY=9,SELF=100,HOT=100,market={group:{},pageCount:1,current:0,next:0,last:0},CustButton=React.createClass({displayName:"CustButton",render:function(){for(var e=this.props.button,t=Math.ceil((e.length+1)/8),a=[],n=function(e){var t={backgroundImage:"url(images/"+e.image1+")"};return React.createElement("div",null,React.createElement("a",{className:"btn btn-default",style:t,href:e.url,id:e.id},e.title))},r=function(e){return e.length<8&&e.push({image1:"gengduo.png",url:"pobo:uncheck=1&pageId=900005&url=main/view/index-add.html",id:"",title:"添加"}),e.map(n)},c=0;c<t;c++)a.push(React.createElement("div",{className:"btn-wrap clearfix"},r(e.slice(8*c,8*c+8))));return React.createElement("div",{className:"area clearfix"},a)}}),InfoList=React.createClass({displayName:"InfoList",getDefaultProps:function(){return{dir:""}},render:function(){var e=function(e){var t=this.props.dir+"info/view/info-de.html?newsId="+e.ID,a=e.Pubtime.split(" ");return React.createElement("a",{className:"list-group-item clearfix",href:t},React.createElement("span",{className:"title",dangerouslySetInnerHTML:{__html:e.Title}}),React.createElement("span",{className:"time"},a[0]))};return React.createElement("div",{className:"list-group"},this.props.contents.map(e,this))}}),isPoboApp="undefined"!=typeof pbE,contract,contractInterval,prevCustom,navScroll,newsData,newsCurrent,mainConfig,prevConfig,marketScroll,dirStr="pobo:uncheck=0&pageId=904002&url=";if(isPoboApp)var pbHQ=pbE.HQ(),pbSYS=pbE.SYS(),pbINFO=pbE.INFO(),pbZX=pbE.ZX();doReload(!0),$(function(){var e={callbacks:[{module:9e4,callback:function(e){for(var t=e.jData.Data,a=0;a<contract.length;a++)for(var n=0;n<t.length;n++)if(contract[a].code==t[n][10]){var r=0,c=pbHQ.hqGetPriceRate(contract[a].code,contract[a].market),o=JSON.parse(pbHQ.hqGetZDInfo(contract[a].code,contract[a].market));contract[a].zd=o.HQZD,contract[a].zdf=o.HQZDF,contract[a].groupflag=pbHQ.hqGetGroupFlag(contract[a].code,contract[a].market),contract[a].decimal=pbHQ.hqGetPriceDecimal(contract[a].code,contract[a].market),t[n][29]?(r=(t[n][29]-0)/c,contract[a].price=decimalDecPrice(contract[a].decimal,r)):contract[a].price="--";var i=$("#market-href-"+a).attr("href","pobo:uncheck=0&pageId=801001&market="+contract[a].market+"&code="+contract[a].code+"&groupflag="+contract[a].groupflag+"&hideflag=1").removeClass(),s=$("#market-price-"+a),l=s.find("img"),m=$("#market-chg-"+a+" span");isNaN(contract[a].zd)||(contract[a].zd>0?(i.addClass("up"),l.attr("src","../images/high.png")):contract[a].zd<0?(i.addClass("down"),l.attr("src","../images/low.png")):contract[a].zdf="0%"),m[0].innerHTML=contract[a].zd||"--",m[1].innerHTML=contract[a].zdf||"--",s.find("span").html(contract[a].price),$("#market-name-"+a).html(contract[a].name);break}}},{module:90004,callback:function(e){newsData[newsCurrent]=e.jData.Indexes.slice(0,mainConfig.news.data[newsCurrent].count),ReactDOM.render(React.createElement(InfoList,{contents:newsData[newsCurrent],dir:dirStr}),document.getElementById("info-list"))}}],reload:function(){doReload(!1)},refresh:function(){},fresh:function(){},doShow:function(e){e?config.contracts.isShow&&setMarketInterval(!0):config.contracts.isShow&&setMarketInterval(!1)}};pbPage.initPage(e)});