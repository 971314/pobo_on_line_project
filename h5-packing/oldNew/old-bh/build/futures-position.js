function decimalDec(o,i){i+="";var t=i.indexOf("."),n=i.length;return i=t>=0&&n-1-t>=o+1?i.substr(0,i.indexOf(".")+o+2):(i-0).toFixed(o+1)}function decimalDecPrice(o,i){i+="";var t=i.indexOf("."),n=i.length;return i=t>=0&&n-1-t>=o?i.substr(0,i.indexOf(".")+o+1):(i-0).toFixed(o)}function fresh(){close=0,plFlag=0,p=0,pbEngine.queryMoney(CID,JSON.stringify({})),tradePart(CID)}function tradePart(o){var i=pbEngine.queryStockRe(o);if(i)if(position=JSON.parse(i).data,position.length>0){var t={},n=[],e=[];stockInfo=[],marketInfo=[];for(var s=0;s<position.length;s++){position[s].flag=0;var p=position[s][54],a=position[s][63],r={},l=0;marketInfo=JSON.parse(pbEngine.getHQInfo(a,p)),a.indexOf("&")>=0&&(l=1),marketInfo.HQCode&&marketInfo.HQMarket&&!isNaN(position[s][136])&&!l||(position[s].flag=1);var c=pbEngine.getHQPriceRate(marketInfo.HQCode,marketInfo.HQMarket),d=pbEngine.getTradeMSSL(a,p);r[1]=marketInfo.HQCode,r[2]=position[s][136]-0,r[3]=position[s][135]-0,r[4]=c,r[5]=d,r[6]=position[s][112],stockInfo.push(r),e.indexOf(marketInfo.HQCode)<0&&(e.push(marketInfo.HQCode),n.push({2:marketInfo.HQMarket,3:marketInfo.HQCode})),position[s].market=marketInfo.HQMarket,position[s].code=marketInfo.HQCode,position[s].groupflag=pbEngine.getHQGroupFlag(marketInfo.HQCode,marketInfo.HQMarket),position[s].decimal=pbEngine.getHQPriceDecimal(marketInfo.HQCode,marketInfo.HQMarket),position[s][136]=position[s][136]+"",position[s][136]=decimalDec(position[s].decimal,position[s][136]),position[s].available=position[s][137],position[s].flag?position[s].flag&&(position[s].profit="--",position[s].price="--"):(position[s].price=pbEngine.getHQNowPrice(marketInfo.HQCode,marketInfo.HQMarket),position[s].base=pbEngine.getHQLastBasePrice(marketInfo.HQCode,marketInfo.HQMarket),position[s].price&&!isNaN(position[s].price)?(position[s].profit=((position[s].price-position[s][136]-0).toFixed(4)-0)*position[s][135]*d,"1"==position[s][112]&&(position[s].profit=0-position[s].profit),position[s].profit=(position[s].profit-0).toFixed(2)):position[s].base&&!isNaN(position[s].base)&&(position[s].profit=((position[s].base-position[s][136]-0).toFixed(4)-0)*position[s][135]*d,"1"==position[s][112]&&(position[s].profit=0-position[s].profit),position[s].profit=(position[s].profit-0).toFixed(2),position[s].price="--"),"1"==position[s][503]?position[s].price&&!isNaN(position[s].price)&&(position[s].dayPl=((position[s].price-position[s][136]-0).toFixed(4)-0)*position[s][135]*d,"1"==position[s][112]&&(position[s].dayPl=0-position[s].dayPl)):"2"==position[s][503]?position[s].price&&!isNaN(position[s].price)&&position[s].base&&!isNaN(position[s].base)&&(position[s].dayPl=((position[s].price-position[s].base-0).toFixed(4)-0)*position[s][135]*d,"1"==position[s][112]&&(position[s].dayPl=0-position[s].dayPl)):"0"==position[s][503]&&(position[s][1101]==position[s][135]?position[s].price&&!isNaN(position[s].price)&&(position[s].dayPl=((position[s].price-position[s][1102]-0).toFixed(4)-0)*position[s][1101]*d,"1"==position[s][112]&&(position[s].dayPl=0-position[s].dayPl)):position[s][1101]<position[s][135]&&position[s].price&&!isNaN(position[s].price)&&position[s].base&&!isNaN(position[s].base)&&(position[s].dayPl=((position[s].price-position[s][1102]-0).toFixed(4)-0)*position[s][1101]*d+((position[s].price-position[s].base-0).toFixed(4)-0)*(position[s][135]-position[s][1101]-0)*d,"1"==position[s][112]&&(position[s].dayPl=0-position[s].dayPl))))}ReactDOM.render(React.createElement(PositionContentsFutures,{contents:position}),document.getElementById("contents"));var f=!1;totalPL=0,sumPl=0;for(var s=0,g=position.length;s<g;s++){if("undefined"==typeof position[s].dayPl||isNaN(position[s].dayPl)){if(position[s].flag)continue;f=!1;break}totalPL+=position[s].dayPl-0,f=!0}f&&(plFlag=1,close&&(closePl-=0,totalPL-=0,charge-=0,sumPl=(closePl+totalPL-charge-0).toFixed(2),$("#float").html(sumPl+"元"))),t[1]=n,t[7]="1",pbEngine.hqSubscribe(0,JSON.stringify(t))}else position.length<=0&&(pbEngine.stopLoading(),plFlag=1,totalPL=0,stockInfo=[],$("#contents").empty(),closePl&&$("#float").html((closePl-charge-0).toFixed(2)+"元"))}function hqPart(o){for(var i=o.jData.Data,t=0,n=0,e=0,s=stockInfo.length;e<s;e++)if(position[e].flag)position[e].flag&&(position[e].profit="--",position[e].price="--");else for(var a=0,r=i.length;a<r;a++){stockInfo[e][1]==i[a][10]&&(i[a][29]&&!isNaN(i[a][29])?(t=(i[a][29]-0)/stockInfo[e][4],n=((t-stockInfo[e][2]).toFixed(4)-0)*stockInfo[e][3]*stockInfo[e][5],"1"==stockInfo[e][6]&&(n=0-n),t=decimalDecPrice(position[e].decimal,t),stockInfo[e][7]=n,position[e].profit=n,position[e].price=t,position[e].profit=(position[e].profit-0).toFixed(2),position[e].base=pbEngine.getHQLastBasePrice(position[e].code,position[e].market),"1"==position[e][503]?position[e].price&&!isNaN(position[e].price)&&(position[e].dayPl=((position[e].price-position[e][136]-0).toFixed(4)-0)*position[e][135]*stockInfo[e][5],"1"==position[e][112]&&(position[e].dayPl=0-position[e].dayPl)):"2"==position[e][503]?position[e].price&&!isNaN(position[e].price)&&position[e].base&&!isNaN(position[e].base)&&(position[e].dayPl=((position[e].price-position[e].base-0).toFixed(4)-0)*position[e][135]*stockInfo[e][5],"1"==position[e][112]&&(position[e].dayPl=0-position[e].dayPl)):"0"==position[e][503]&&(position[e][1101]==position[e][135]?position[e].price&&!isNaN(position[e].price)&&(position[e].dayPl=((position[e].price-position[e][1102]-0).toFixed(4)-0)*position[e][1101]*stockInfo[e][5],"1"==position[e][112]&&(position[e].dayPl=0-position[e].dayPl)):position[e][1101]<position[e][135]&&position[e].price&&!isNaN(position[e].price)&&position[e].base&&!isNaN(position[e].base)&&(position[e].dayPl=((position[e].price-position[e][1102]-0).toFixed(4)-0)*position[e][1101]*stockInfo[e][5]+((position[e].price-position[e].base-0).toFixed(4)-0)*(position[e][135]-position[e][1101]-0)*stockInfo[e][5],"1"==position[e][112]&&(position[e].dayPl=0-position[e].dayPl)))):position[e].dayPl=0);break}ReactDOM.render(React.createElement(PositionContentsFutures,{contents:position}),document.getElementById("contents"));var l=!1;totalPL=0,sumPl=0;for(var e=0,s=stockInfo.length;e<s;e++){if("undefined"==typeof position[e].dayPl||isNaN(position[e].dayPl)){if(position[e].flag)continue;l=!1;break}totalPL+=position[e].dayPl-0,l=!0}l&&(plFlag=1,p++,close&&(sumPl=(totalPL-0+(closePl-0)-charge-0).toFixed(2),$("#float").html(sumPl+"元"),1==p&&pbEngine.stopLoading()),ReactDOM.render(React.createElement(PositionContentsFutures,{contents:position}),document.getElementById("contents")))}function callback(o){var i=JSON.parse(o);if(90002==i.moduleId)if(6012==i.functionNO){if(asset=i.jData.data[0],close=1,closePl=asset[102]-0,charge=asset[182]-0,asset[97]=(asset[97]-0).toFixed(2),asset[152]=(asset[152]-0).toFixed(2),asset[111]=(asset[111]-0).toFixed(2),plFlag)asset.sumPl=(totalPL-0+(closePl-0)-charge-0).toFixed(2);else{var t=$("#float").html();asset.sumPl=t.substring(0,t.length-1)}ReactDOM.render(React.createElement(FundsInfoFutures,{info:asset}),document.getElementById("fund"))}else 56004==i.functionNO&&i.reservId==CID?5==i.jData[223]&&(refreshFlag||(pbEngine.stopLoading(),refreshFlag=1),fresh()):56005==i.functionNO&&i.reservId==CID?fresh():56006==i.functionNO&&i.reservId==CID?fresh():56014==i.functionNO&&i.reservId==CID&&fresh();else 9e4==i.moduleId&&(totalPL=0,hqPart(i))}function reload(){close=0,plFlag=0,CID=pbEngine.getTradeCurrentConnectionCID(),p=0,pbEngine.queryMoney(CID,JSON.stringify({})),pbEngine.startLoading(),tradePart(CID)}function isShow(o){o||pbEngine.stopLoading()}function refresh(){close=0,plFlag=0,pbEngine.startLoading(),refreshFlag=0,pbEngine.queryMoney(CID,JSON.stringify({})),pbEngine.synFlash(CID)}var marketInfo,totalPL,position,stockInfo=[],p=0,asset,refreshFlag=1,CID=pbEngine.getTradeCurrentConnectionCID(),closePl,sumPl,charge,close=0,plFlag=0,CONTENT1=pbEngine.queryMoneyRe(CID);if(CONTENT1){var assetHis=JSON.parse(CONTENT1).data[0];assetHis[97]=(assetHis[97]-0).toFixed(2),assetHis[152]=(assetHis[152]-0).toFixed(2),assetHis[111]=(assetHis[111]-0).toFixed(2),assetHis.sumPl="--",ReactDOM.render(React.createElement(FundsInfoFutures,{info:assetHis}),document.getElementById("fund"))}p=0,pbEngine.startLoading(),pbEngine.queryMoney(CID,JSON.stringify({})),tradePart(CID);