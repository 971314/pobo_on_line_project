"use strict";function getCurrency(e){switch(e-=0){case 0:return"人民币";case 1:return"美元";case 2:return"港币";case 3:return"欧元";case 4:return"澳元";case 5:return"日元";case 6:return"台湾币";default:return"未知"}}function getUnit(e){switch(e-=0){case 0:return"元";case 1:return"美元";case 2:return"港币";case 3:return"欧元";case 4:return"澳元";case 5:return"日元";case 6:return"台币";default:return"未知"}}function JTrim(e){return e.replace(/(^\s*)|(\s*$)/g,"")}function setLiBank(e){for(var a="",n={},r=0,t=e.length;r<t;r++){var d=e[r][214],c={56:[]};n.hasOwnProperty(d)?n[d][56].indexOf(e[r][56])<0&&n[d][56].push(e[r][56]):(c[56].push(e[r][56]),c[215]=e[r][215],c[216]=e[r][216],c[51]=e[r][51],c[353]=e[r][353],c[219]=e[r][219],c[214]=e[r][214],n[d]=c)}var s=0;for(var l in n)if(0==s){var i=l.slice(-4);a+='<li value="'+l+'" data-code="'+n[l][215]+'" data-name="'+n[l][216]+'" data-currency="'+n[l][56]+'" data-account="'+n[l][51]+'" center-code="'+n[l][353]+'" balnceFlag="'+n[l][219]+'" bank-account="'+n[l][214]+'" class="hover"><span class="b1">'+n[l][216]+'<span class="d8">(尾号'+i+")</span></span>",4==n[l][219]?($("#moneyPwd").removeClass("hide"),$("#bankPwd").addClass("hide")):5==n[l][219]?($("#bankPwd").removeClass("hide"),$("#moneyPwd").addClass("hide")):6==n[l][219]?($("#bankPwd").removeClass("hide"),$("#moneyPwd").removeClass("hide")):7==n[l][219]&&($("#bankPwd").addClass("hide"),$("#moneyPwd").addClass("hide")),oBank.innerHTML='<span class="b1">'+n[l][216]+'<span class="d8">(尾号'+i+")</span></span>";var u=setLiCurrency(n[l][56]);$("#currency-ul").empty(),$("#currency-ul").append(u),$("#result-account").html(l),$("#result-bank").html(n[l][216]),bankCode=n[l][215],bankAccount=n[l][214],fundAccount=n[l][51],bankCenter=n[l][353],s++}else{var i=l.slice(-4);a+='<li value="'+l+'" data-code="'+n[l][215]+'" data-name="'+n[l][216]+'" data-currency="'+n[l][56]+'" data-account="'+n[l][51]+'" center-code="'+n[l][353]+'" balnceFlag="'+n[l][219]+'" bank-account="'+n[l][214]+'"><span class="b1">'+n[l][216]+'<span class="d8">(尾号'+i+")</span></span>",s++}return a}function setLiCurrency(e){for(var a="",n=0,r=e.length;n<r;n++)if(parseInt(e[n]+1)){var t=getCurrency(e[n]),d=getUnit(e[n]);0==n?(a+='<li data-currency="'+t+'" currency-unit="'+d+'" currencyCode="'+e[n]+'" class="hover">'+t+"</li>",oCurrency.innerHTML=t,$("#currency-unit").val(d),currencyCode=e[n]):a+='<li data-currency="'+t+'" currency-unit="'+d+'" currencyCode="'+e[n]+'">'+t+"</li>"}return a}function confirmIn(){$(".my-modal").addClass("hide"),$("#error").addClass("hide");var e=(new RegExp("^[0-9]*$"),document.getElementById("inAmount")),a=document.getElementById("inBankPwd").value,n=document.getElementById("inFundPwd").value;if(""==JTrim(e.value))return $("#error").removeClass("hide"),void $("#error").html("请输入转账金额！");if(!/^[0-9]+(.[0-9]{1,8})?$/.test(e.value))return $("#error").removeClass("hide"),void $("#error").html("转账金额要为数字！");if($("#moneyPwd").hasClass("hide")||$("#bankPwd").hasClass("hide"))if($("#moneyPwd").hasClass("hide")&&!$("#bankPwd").hasClass("hide")){if(""==JTrim(a))return $("#error").removeClass("hide"),void $("#error").html("请输入银行密码！");$("#error").addClass("hide"),$(".my-modal").removeClass("hide"),$(".my-modal-backdrop").click(function(){$(".my-modal").addClass("hide")}),$("#result-amount").html($("#inAmount").val()+$("#currency-unit").val()),bankPwd=pbEngine.encrypt(CID,$("#inBankPwd").val())}else if(!$("#moneyPwd").hasClass("hide")&&$("#bankPwd").hasClass("hide")){if(""==JTrim(n))return $("#error").removeClass("hide"),void $("#error").html("请输入资金密码！");$("#error").addClass("hide"),$(".my-modal").removeClass("hide"),$(".my-modal-backdrop").click(function(){$(".my-modal").addClass("hide")}),$("#result-amount").html($("#inAmount").val()+$("#currency-unit").val()),fundPwd=pbEngine.encrypt(CID,$("#inFundPwd").val())}else $("#error").addClass("hide"),$(".my-modal").removeClass("hide"),$(".my-modal-backdrop").click(function(){$(".my-modal").addClass("hide")}),$("#result-amount").html($("#inAmount").val()+$("#currency-unit").val());else{if(""==JTrim(a))return $("#error").removeClass("hide"),void $("#error").html("请输入银行密码！");if(""==JTrim(n))return $("#error").removeClass("hide"),void $("#error").html("请输入资金密码！");$("#error").addClass("hide"),$(".my-modal").removeClass("hide"),$(".my-modal-backdrop").click(function(){$(".my-modal").addClass("hide")}),$("#result-amount").html($("#inAmount").val()+$("#currency-unit").val()),fundPwd=pbEngine.encrypt(CID,$("#inFundPwd").val()),bankPwd=pbEngine.encrypt(CID,$("#inBankPwd").val())}}function cancelIn(){$(".my-modal").addClass("hide")}function completeIn(){$(".my-modal").addClass("hide"),$("#error").addClass("hide");var e={214:bankAccount,215:bankCode,51:fundAccount,56:currencyCode,59:fundPwd,60:bankPwd,220:$("#inAmount").val(),353:bankCenter};pbEngine.generalRequest(CID,6202,JSON.stringify(e))}function completeOut(){$(".my-modal").addClass("hide"),$("#error").addClass("hide");var e={214:bankAccount,215:bankCode,51:fundAccount,56:currencyCode,59:fundPwd,60:bankPwd,220:$("#inAmount").val(),353:bankCenter};pbEngine.generalRequest(CID,6201,JSON.stringify(e))}function callback(e){var a=JSON.parse(e);if(6200==a.functionNO)if(a.jData[1]<0)alert(a.jData[2]);else{var n=a.jData.data,r=setLiBank(n);$("#bank-ul").empty(),$("#bank-ul").append(r)}else 6202!=a.functionNO&&6201!=a.functionNO||(a.jData[1]<0?alert(a.jData[2]):alert("提交银行处理"))}var CID=pbEngine.getTradeCurrentConnectionCID(),oBank=document.getElementById("bank"),oCurrency=document.getElementById("currency"),fundPwd="",bankPwd="",bankCode,bankAccount,currencyCode,fundAccount,bankCenter;pbEngine.generalRequest(CID,6200,JSON.stringify({})),$(document).ready(function(){$("body").click(function(){$("#bank-ul").addClass("hide"),$("#currency-ul").addClass("hide")}),$(".bank-div").click(function(e){$("#currency-ul").addClass("hide"),$("#bank-ul").toggleClass("hide"),$("#bank").focus(),e.stopPropagation()}),$("#bank-ul").on("click","li",function(){bankCode=$(this).attr("data-code"),bankAccount=$(this).attr("bankAccount"),fundAccount=$(this).attr("data-account"),bankCenter=$(this).attr("center-code"),$("#bank").val($(this).html()),$("#bank-name").val($(this).attr("data-name")),$("#bank-val").val($(this).attr("value")),$("#bank-code").val($(this).attr("data-code")),$("#bank-currency").val($(this).attr("data-currency")),$("#fund-account").val($(this).attr("data-account")),$("#bank-center").val($(this).attr("center-code")),$("#bank-ul .hover").removeClass("hover"),$(this).addClass("hover"),4==$(this).attr("balnceFlag")?($("#moneyPwd").removeClass("hide"),$("#bankPwd").addClass("hide")):5==$(this).attr("balnceFlag")?($("#bankPwd").removeClass("hide"),$("#moneyPwd").addClass("hide")):6==$(this).attr("balnceFlag")?($("#bankPwd").removeClass("hide"),$("#moneyPwd").removeClass("hide")):7==$(this).attr("balnceFlag")?($("#bankPwd").addClass("hide"),$("#moneyPwd").addClass("hide")):0!=$(this).attr("balnceFlag")&&$(this).attr("balnceFlag")||($("#bankPwd").addClass("hide"),$("#moneyPwd").addClass("hide")),oBank.innerHTML=$("#bank").val();var e=setLiCurrency($("#bank-currency").val());$("#currency-ul").empty(),$("#currency-ul").append(e),$("#result-account").html($("#bank-val").val()),$("#result-bank").html($("#bank-name").val()),$("#currency-ul li").click(function(){currencyCode=$(this).attr("currencyCode"),$("#currency").html($(this).val()),$("#currency-unit").val($(this).attr("currency-unit")),$("#currency-ul .hover").removeClass("hover"),$(this).addClass("hover"),oCurrency.innerHTML=$(this).html()})}),$(".currency-div").click(function(e){$("#bank-ul").addClass("hide"),$("#currency-ul").toggleClass("hide"),$("#currency").focus(),e.stopPropagation()}),$("#currency-ul li").click(function(){$("#currency").html($(this).val()),$("#currency-unit").val($(this).attr("currency-unit")),$("#currency-ul .hover").removeClass("hover"),$(this).addClass("hover"),oCurrency.innerHTML=$(this).html()})});